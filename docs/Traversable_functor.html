<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Traversable Functor - PureScript For JavaScript Developers</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">PureScript For JavaScript Developers</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="traversable-functors"><a class="header" href="#traversable-functors">Traversable Functors</a></h2>
<h3 id="javascript-context-validating-arrays-of-data"><a class="header" href="#javascript-context-validating-arrays-of-data">JavaScript Context: Validating Arrays of Data</a></h3>
<p>In JavaScript, you often validate collections of data, like an array of phone numbers, to ensure each element is valid before using it. A common approach is mapping over the array with a validation function and collecting results or errors:</p>
<pre><code class="language-javascript">function validatePhoneNumber(phone) {
  const regex = /^\d{3}-\d{3}-\d{4}$/;
  return regex.test(phone) ? { valid: true, value: phone } : { valid: false, errors: ["Invalid phone format"] };
}
function validatePhones(phones) {
  const results = phones.map(validatePhoneNumber);
  const errors = results.filter(r =&gt; !r.valid).map(r =&gt; r.errors).flat();
  return errors.length ? { valid: false, errors } : { valid: true, value: results.map(r =&gt; r.value) };
}
console.log(validatePhones(["555-555-5555", "555-555-0000"])); 
// { valid: true, value: ["555-555-5555", "555-555-0000"] }
console.log(validatePhones(["555-555-5555", "invalid"])); 
// { valid: false, errors: ["Invalid phone format"] }
</code></pre>
<p><strong>How This Differs from the Applicative Example</strong>: Unlike the Applicative example’s <code>createUserValidated</code>, which validates and combines independent inputs (first name, last name, email) into a single user object, this example iterates over a single array of phone numbers, applying <code>validatePhoneNumber</code> to each element and collecting results or errors while keeping the array structure. The Applicative example lifts a function over multiple validated inputs, whereas this maps a validation function across a collection, preserving its shape. This distinction highlights Traversable’s focus on processing each element in a structure, not combining separate values.</p>
<p>This pattern—mapping a validation function over an array and collecting results or errors—is common in form validation or data processing. However, it’s repetitive and specific to arrays. If you need to validate other structures (like optional values or nested objects), you write custom code for each. There’s no type safety to ensure the validation function and data match, and runtime errors can occur if inputs are unexpected types, like non-strings in the <code>phones</code> array.</p>
<h3 id="purescripts-traversable-structured-iteration-with-effects"><a class="header" href="#purescripts-traversable-structured-iteration-with-effects">PureScript’s <code>Traversable</code>: Structured Iteration with Effects</a></h3>
<p>PureScript’s <code>Traversable</code> type class builds on <code>Functor</code> and <code>Foldable</code> to iterate over a data structure (like arrays, optionals, or custom types), applying an effectful function (e.g., validation) to each element and collecting results in a new structure of the same shape, with type safety. It’s defined as:</p>
<pre><code class="language-purescript">class (Functor t, Foldable t) &lt;= Traversable t where
  traverse :: forall a b m. Applicative m =&gt; (a -&gt; m b) -&gt; t a -&gt; m (t b)
  sequence :: forall a m. Applicative m =&gt; t (m a) -&gt; m (t a)
</code></pre>
<ul>
<li><code>traverse</code> applies an effectful function (e.g., <code>a -&gt; m b</code>, where <code>m</code> is an Applicative like <code>V Errors</code>) to each element of a structure <code>t a</code>, producing a new structure <code>m (t b)</code> with combined effects.</li>
<li><code>sequence</code> flips a structure of effectful computations <code>t (m a)</code> into an effectful structure <code>m (t a)</code>.</li>
</ul>
<p>The key idea is that <code>Traversable</code> lets you “walk” a structure, apply a function that produces effects (like validation errors), and collect results while preserving the structure’s shape. For example, <code>traverse</code> can validate an array of phone numbers, producing either a valid array or a collection of errors.</p>
<p>For arrays with validation (using <code>V Errors</code> from <code>purescript-validation</code>):</p>
<p>In PSCi, paste (using <code>:paste</code> mode, then <code>Ctrl+D</code>):</p>
<pre><code class="language-purescript">import Prelude
import Effect.Console
import Data.Array
import Data.Traversable
import Data.Validation.Semigroup
import Data.List.NonEmpty (singleton)
import Data.String.Regex
import Data.String.Regex.Unsafe
import Data.String.Regex.Flags
newtype PhoneNumber = PhoneNumber String
instance Show PhoneNumber where
  show (PhoneNumber s) = "(PhoneNumber " &lt;&gt; show s &lt;&gt; ")"
phoneNumberRegex = unsafeRegex "^\\d{3}-\\d{3}-\\d{4}$" noFlags
validatePhoneNumber s = if test phoneNumberRegex s
  then pure (PhoneNumber s)
  else invalid (singleton "Invalid phone format")
phones = ["555-555-5555", "555-555-0000"]
logShow $ traverse validatePhoneNumber phones {- - Validates each phone number -}
badPhones = ["555-555-5555", "invalid"]
logShow $ traverse validatePhoneNumber badPhones {- - Collects errors -}
</code></pre>
<p>Expected output:</p>
<pre><code>(valid [(PhoneNumber "555-555-5555"),(PhoneNumber "555-555-0000")])
unit
(invalid (["Invalid phone format"]))
unit
</code></pre>
<p>For <code>Maybe</code> (optional values):</p>
<p>In PSCi, paste (using <code>:paste</code> mode, then <code>Ctrl+D</code>):</p>
<pre><code class="language-purescript">import Prelude
import Effect.Console (logShow)
import Data.Maybe (Maybe(..))
import Data.Traversable (traverse)
import Data.List.Types (NonEmptyList(..), List(..))
import Data.Validation.Semigroup (V, invalid)
import Data.NonEmpty (NonEmpty(..), singleton)

nonEmpty field s = 
  if s == "" 
    then invalid (NonEmpty ("Field '" &lt;&gt; field &lt;&gt; "' cannot be empty") Nil)
    else pure s

logShow $ traverse (nonEmpty "Example") Nothing -- No validation for Nothing
logShow $ traverse (nonEmpty "Example") (Just "") -- Validates Just value
logShow $ traverse (nonEmpty "Example") (Just "Testing") -- Successful validation
</code></pre>
<p>Expected output:</p>
<pre><code>(valid Nothing)
unit
(invalid (["Field 'Example' cannot be empty"]))
unit
(valid (Just "Testing"))
unit
</code></pre>
<p>The compiler ensures <code>Traversable</code> instances exist and types match, catching errors at compile time. Traversable laws ensure the structure is preserved and effects are combined predictably, unlike JavaScript’s ad hoc validation.</p>
<h3 id="why-traversable-is-helpful"><a class="header" href="#why-traversable-is-helpful">Why <code>Traversable</code> Is Helpful</a></h3>
<ol>
<li>
<p><strong>Unified Iteration with Effects</strong>: Unlike JS’s array-specific validation loops, <code>Traversable</code> works across structures (arrays, <code>Maybe</code>, custom types), applying effectful functions uniformly.</p>
</li>
<li>
<p><strong>Type Safety</strong>: Ensures the validation function and structure are compatible, avoiding JS runtime errors from mismatched types.</p>
</li>
<li>
<p><strong>Reusable Code</strong>: One <code>traverse</code> function handles various structures, reducing custom code compared to JS’s structure-specific loops.</p>
</li>
</ol>
<h3 id="practical-example-validating-a-list-of-names"><a class="header" href="#practical-example-validating-a-list-of-names">Practical Example: Validating a List of Names</a></h3>
<p>Validate an array of names using <code>traverse</code>:</p>
<p>In PSCi, paste (using <code>:paste</code> mode, then <code>Ctrl+D</code>):</p>
<pre><code class="language-purescript">import Prelude
import Effect.Console (logShow)
import Data.Array
import Data.Traversable (traverse)
import Data.List.Types (NonEmptyList(..), List(..))
import Data.Validation.Semigroup (V, invalid)
import Data.NonEmpty (NonEmpty(..), singleton)
nonEmpty field s = if s == ""
  then invalid (NonEmpty ("Field '" &lt;&gt; field &lt;&gt; "' cannot be empty") Nil)
  else pure s
logShow $ traverse (nonEmpty "Name") ["Phillip", "Freeman"] {- - Validates each name -}
logShow $ traverse (nonEmpty "Name") ["Phillip", ""] {- - Collects errors -}
</code></pre>
<p>Expected output:</p>
<pre><code>(valid ["Phillip","Freeman"])
unit
(invalid (["Field 'Name' cannot be empty"]))
unit
</code></pre>
<p>This generalizes validation across structures, similar to JavaScript’s array validation but safer and more flexible.</p>
<h3 id="repl-exercises"><a class="header" href="#repl-exercises">REPL Exercises</a></h3>
<p>Try these in a fresh PSCi session (run <code>:clear</code> first). Copy and paste each block using <code>:paste</code> mode (type <code>:paste</code>, paste the code, then press <code>Ctrl+D</code> to execute):</p>
<ol>
<li>
<p><strong>Traverse with Array</strong>:</p>
<pre><code class="language-purescript">import Prelude
import Effect.Console (logShow)
import Data.Array
import Data.Traversable (traverse)
import Data.List.Types (NonEmptyList(..), List(..))
import Data.Validation.Semigroup (V, invalid)
import Data.NonEmpty (NonEmpty(..), singleton)
nonEmpty field s = if s == ""
  then invalid (NonEmpty ("Field '" &lt;&gt; field &lt;&gt; "' cannot be empty") Nil)
  else pure s
logShow $ traverse (nonEmpty "Name") ["Phillip", "Freeman"] {- - Validate names in array -}
logShow $ traverse (nonEmpty "Name") ["Phillip", ""] {- - Collect errors -}
</code></pre>
<p>Expected output:</p>
<pre><code>(valid ["Phillip","Freeman"])
unit
(invalid (["Field 'Name' cannot be empty"]))
unit
</code></pre>
</li>
<li>
<p><strong>Traverse with Maybe</strong>:</p>
<pre><code class="language-purescript">import Prelude
import Effect.Console (logShow)
import Data.Maybe (Maybe(..))
import Data.Traversable (traverse)
import Data.List.Types (NonEmptyList(..), List(..))
import Data.Validation.Semigroup (V, invalid)
import Data.NonEmpty (NonEmpty(..), singleton)
nonEmpty field s = if s == ""
  then invalid (NonEmpty ("Field '" &lt;&gt; field &lt;&gt; "' cannot be empty") Nil)
  else pure s
logShow $ traverse (nonEmpty "Example") Nothing {- - No validation for Nothing -}
logShow $ traverse (nonEmpty "Example") (Just "") {- - Validate Just value -}
logShow $ traverse (nonEmpty "Example") (Just "Testing") {- - Successful validation -}
</code></pre>
<p>Expected output:</p>
<pre><code>(valid Nothing)
unit
(invalid (["Field 'Example' cannot be empty"]))
unit
(valid (Just "Testing"))
unit
</code></pre>
</li>
</ol>
<h3 id="summary"><a class="header" href="#summary">Summary</a></h3>
<p>JavaScript’s array validation loops, like <code>validatePhones</code>, are repetitive, array-specific, and risk runtime errors. PureScript’s <code>Traversable</code> type class provides a type-safe, reusable way to apply effectful functions (like validation) across structures like arrays, <code>Maybe</code>, or custom types, preserving their shape while combining effects. Unlike Applicative functors, which combine independent effectful values (like form fields in <code>createUserValidated</code>), Traversables iterate over a single structure’s elements, making them ideal for validating collections. For JavaScript developers, <code>Traversable</code> simplifies validating data in diverse structures, catching errors early and reducing custom code.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Applicative.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="Monads.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Applicative.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="Monads.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
